<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="W. David Walter">
<title>Manual-Applied-Spatial-Ecology - 33&nbsp; Preparing Additional Covariates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./MuledeerSR.html" rel="next">
<link href="./LinearDistScript.html" rel="prev">
<link href="./CoverSlide2.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Resource-Selection.html">Resource Selection</a></li><li class="breadcrumb-item"><a href="./MD_DataPrep.html"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Preparing Additional Covariates</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Manual-Applied-Spatial-Ecology</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/walterASEL/Manual-of-Applied-Spatial-Ecology" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manual of Applied Spatial Ecology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Data-Manipulation-Management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Manipulation and Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MDprojections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transformations between coordinate systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TimeLagScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Import and Format Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SoilScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulate Polygon Layer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RasterScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Manipulate Raster Data Layer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GridScripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating a Hexagonal Polygon Grid Over a Study Area</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GridSystem2Script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Creating a Square Polygon Grid Over a Study Area</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BufferScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Creating Buffers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MidAtlantic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mid-Atlantic layers using online sources</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Climate-Data-Interpretion.qmd</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ReadFilesScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Climate Data Interpretation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weather-Station-Code_Snowfall.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Using Data in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NetCDF_Script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Dynamically Downscaled Global Climate Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Movement-Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DMAdeerMovebank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Movement Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MovementScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Movement Trajectories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DistanceUniqueBurst.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Distance Between Locations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FPTscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">First Passage Time (FPT)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegTrajScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Regular Trajectories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NSDscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Net Squared Displacement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TrajDynScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Movement Trajectory Animation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Home-Range-Estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home Range Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HrefScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Kernel Density Estimation (KDE) with reference bandwidth selection (href)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HlscvScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Kernel Density Estimation (KDE) with least squares cross validation (lscv)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Panther_All4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Kernel density estimators (KDE) with various bandwidth selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Panther_All4_amt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Kernel density estimators (KDE) with various bandwidth selection using package amt</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BBMMscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Brownian Bridge Movement Models (BBMM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MKDEcat_script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Movement-based Kernel Density Estimation (MKDE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CatdBBMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Dynamic Brownian Bridge Movement Models (dBBMM)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Landscape-Metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Landscape Metrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Frag_Auto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Landscape Metrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PatchAnalystScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Fragstats Metrics within Buffers</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Resource-Selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resource Selection</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MCPscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Resource Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LinearDistScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Preparing Linear Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MD_DataPrep.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Preparing Additional Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MuledeerSR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Selection Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LogisticRSF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NegBinomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Negative Binomial</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Preparing Additional Covariates</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>We may often be interested in assessing various covariates that may influence resource selection of our study animals. If we have a priori knowledge that elevation or slope may influence selection for or use of portions of the landscape then we need to create these layers for analysis. While this may not seem like a very complicated process because it is routinely done in ArcMap, those same available layers can be used and manipulated in R as in Chapter 1. We can then create slope, aspect, hillshade or other variables within R using concepts in earlier chapters and extract those covariates for use in modeling all within the R environment.</p>
<p>1. Open the script MD_DataPrep.Rmd” and run code directly from the script</p>
<p>2. First we need to load the packages needed for the exercise</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">adehabitatHR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/FedData/">FedData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3. Now let’s have a separate section of code to include projection information we will use throughout the exercise. In previous versions, these lines of code were within each block of code</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ll.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4269</span><span class="op">)</span></span>
<span><span class="va">utm.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">9001</span><span class="op">)</span></span>
<span><span class="va">albers.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">5070</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4. Load the mule deer dataset we used in the previous exercise</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">muleys</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/muleysexample.csv"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#Remove outlier locations</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">muleys</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">ll.crs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>,axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">deer.spdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">coords</span>, xmin<span class="op">=</span><span class="op">-</span><span class="fl">107.0</span>,xmax<span class="op">=</span><span class="op">-</span><span class="fl">110.5</span>,ymin<span class="op">=</span><span class="fl">37.8</span>,ymax<span class="op">=</span><span class="fl">39.0</span><span class="op">)</span><span class="co">#Visually identified based on previous plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">deer.spdf</span><span class="op">)</span>,axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="5" type="1">
<li>Only use code in this section for example exercise so fewer locations are used.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">deer.spdf</span> <span class="op">&lt;-</span> <span class="va">deer.spdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">deer.spdf</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Project deer.spdf to Albers as in previous exercise</span></span>
<span><span class="va">deer.albers</span> <span class="op">&lt;-</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">deer.spdf</span>, crs<span class="op">=</span><span class="va">albers.crs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">deer.albers</span><span class="op">)</span>,axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>6. If we get some NA errors because our grid does not encompass our panther locations then we can expand the grid size extending beyond our locations using methods in an earlier exercise.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create vectors of the x and y points using boundary box created around deer locations</span></span>
<span><span class="va">bb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">deer.albers</span><span class="op">)</span></span>
<span>     </span>
<span><span class="va">increment</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="va">minx</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">xmin</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maxx</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">xmax</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">miny</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">ymin</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maxy</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">minx</span>, xmax <span class="op">=</span> <span class="va">maxx</span>, </span>
<span>                    ymin <span class="op">=</span> <span class="va">miny</span>, ymax <span class="op">=</span> <span class="va">maxy</span><span class="op">)</span>,</span>
<span>                  crs <span class="op">=</span> <span class="fl">5070</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AlbersSP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="va">my_bbox</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>7. Now it is time to import some raster layers of the covariates we are interested in for our analysis. Start with raster of vegetation from the 2012 NRCS Crop data that is a nice dataset that is crop specific for each year. Crop data can be found at the NRCS webpage Cropland Data Layer that can be accessed for each county of each state.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crops</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"data/crop12clip.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reclassify crops raster from above into 9 groups</span></span>
<span><span class="co"># all values between 0 and 20 equal 1, etc.</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">0</span>,<span class="cn">NA</span>,<span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">20</span>, <span class="fl">60</span>, <span class="fl">3</span>, <span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">4</span>, <span class="fl">110</span>, <span class="fl">132</span>, <span class="fl">5</span>, <span class="fl">133</span>, <span class="fl">150</span>, <span class="fl">6</span>, <span class="fl">151</span>, <span class="fl">172</span>, <span class="fl">7</span>, </span>
<span>       <span class="fl">180</span>, <span class="fl">183</span>, <span class="fl">8</span>, <span class="fl">189</span>, <span class="fl">191</span>, <span class="fl">9</span>,<span class="fl">192</span>,<span class="fl">205</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">rclmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">m</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/classify.html">classify</a></span><span class="op">(</span><span class="va">crops</span>, <span class="va">rclmat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">rc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Crop using AlbersSP polygon created earlier to reduce size of raster (if needed).</span></span>
<span><span class="va">bbclip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">rc</span>, <span class="va">AlbersSP</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/coerce.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html">values</a></span><span class="op">(</span><span class="va">bbclip</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="co">#Identifies the number of cells in each category</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    [,1]
1      5
2   1052
3  21750
4   9733
5   2133
6  16290
7  58264
9      9
10    14</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">bbclip</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">deer.albers</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">AlbersSP</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">T</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>8. We also want to look at elevation and covariates related to elevation (e.g., slope, aspect). These can be created directly in R using the terrain function in the raster package. We will use the FedData package to get Digital Elevation Models for the large study area</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">DEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/FedData/reference/get_ned.html">get_ned</a></span><span class="op">(</span>template<span class="op">=</span><span class="va">AlbersSP</span>, label <span class="op">=</span> <span class="st">'COdem'</span>,force.redo <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/image.html">image</a></span><span class="op">(</span><span class="va">DEM</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/contour.html">contour</a></span><span class="op">(</span><span class="va">DEM</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MD_DataPrep_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/terrain.html">terrain</a></span><span class="op">(</span><span class="va">DEM</span>,<span class="st">"slope"</span>, neighbor<span class="op">=</span><span class="fl">8</span>, unit<span class="op">=</span><span class="st">'degrees'</span><span class="op">)</span></span>
<span><span class="va">aspect</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/terrain.html">terrain</a></span><span class="op">(</span><span class="va">DEM</span>,<span class="st">"aspect"</span>, neighbor<span class="op">=</span><span class="fl">8</span>, unit<span class="op">=</span><span class="st">'degrees'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html">project</a></span><span class="op">(</span><span class="va">DEM</span>, <span class="va">bbclip</span>, mask<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html">project</a></span><span class="op">(</span><span class="va">slope</span>, <span class="va">bbclip</span>, mask<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">aspect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html">project</a></span><span class="op">(</span><span class="va">aspect</span>, <span class="va">bbclip</span>, mask<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nlcdclip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">bbclip</span>, <span class="va">slope</span><span class="op">)</span></span>
<span><span class="va">demclip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">elevation</span>, <span class="va">slope</span><span class="op">)</span></span>
<span><span class="va">sloclip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">slope</span>, <span class="va">slope</span><span class="op">)</span></span>
<span><span class="va">aspclip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">aspect</span>, <span class="va">slope</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>9. Cast over all 4 layers to a Spatial Grid Data Frame to permit combining into one layer.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nlcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">nlcdclip</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">demclip</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">slo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">sloclip</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">asp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">aspclip</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Now check to be sure the number of cells in each layer are the same before proceeding the</span></span>
<span><span class="co">#next step of combining layers.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">nlcd</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   109250 obs. of  3 variables:
 $ x         : num  -1128960 -1128930 -1128900 -1128870 -1128840 ...
 $ y         : num  1725360 1725360 1725360 1725360 1725360 ...
 $ CLASS_NAME: num  7 7 7 7 5 7 7 7 6 7 ...</code></pre>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   109250 obs. of  3 variables:
 $ x             : num  -1128960 -1128930 -1128900 -1128870 -1128840 ...
 $ y             : num  1725360 1725360 1725360 1725360 1725360 ...
 $ USGS_1_n38w109: num  2075 2075 2077 2080 2082 ...</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">slo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   109250 obs. of  3 variables:
 $ x    : num  -1128960 -1128930 -1128900 -1128870 -1128840 ...
 $ y    : num  1725360 1725360 1725360 1725360 1725360 ...
 $ slope: num  2.29 2.9 4.54 5.08 4.7 ...</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">asp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   109250 obs. of  3 variables:
 $ x     : num  -1128960 -1128930 -1128900 -1128870 -1128840 ...
 $ y     : num  1725360 1725360 1725360 1725360 1725360 ...
 $ aspect: num  178 213 237 234 222 ...</code></pre>
</div>
</div>
<ol start="10" type="1">
<li>To combine all data frames, we need to match xys so we have the same number of rows of data in each raster. We will use the code below to do this.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">z</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">asp</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">asp</span><span class="op">$</span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">asp</span><span class="op">$</span><span class="va">x</span>, <span class="va">asp</span><span class="op">$</span><span class="va">y</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">z</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">slo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">slo</span><span class="op">$</span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">slo</span><span class="op">$</span><span class="va">x</span>, <span class="va">slo</span><span class="op">$</span><span class="va">y</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">z</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">elev</span><span class="op">$</span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">elev</span><span class="op">$</span><span class="va">x</span>, <span class="va">elev</span><span class="op">$</span><span class="va">y</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">z</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">nlcd</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">nlcd</span><span class="op">$</span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">nlcd</span><span class="op">$</span><span class="va">x</span>, <span class="va">nlcd</span><span class="op">$</span><span class="va">y</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">elev</span> <span class="op">&lt;-</span> <span class="va">elev</span><span class="op">[</span><span class="va">elev</span><span class="op">$</span><span class="va">xy</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html">%in%</a></span> <span class="va">slo</span><span class="op">$</span><span class="va">xy</span>,<span class="op">]</span></span>
<span>  <span class="va">asp</span> <span class="op">&lt;-</span> <span class="va">asp</span><span class="op">[</span><span class="va">asp</span><span class="op">$</span><span class="va">xy</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html">%in%</a></span> <span class="va">asp</span><span class="op">$</span><span class="va">xy</span>,<span class="op">]</span></span>
<span>  <span class="va">nlcd</span> <span class="op">&lt;-</span> <span class="va">nlcd</span><span class="op">[</span><span class="va">nlcd</span><span class="op">$</span><span class="va">xy</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html">%in%</a></span> <span class="va">asp</span><span class="op">$</span><span class="va">xy</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>11. Combine elevation, slope, and aspect into one layer.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">layers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">nlcd</span>, <span class="va">elev</span>, <span class="va">asp</span>, <span class="va">slo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         x       y CLASS_NAME              xy        x       y USGS_1_n38w109
1 -1128960 1725360          7 -11289601725360 -1128960 1725360       2074.788
2 -1128930 1725360          7 -11289301725360 -1128930 1725360       2074.990
3 -1128900 1725360          7 -11289001725360 -1128900 1725360       2076.914
4 -1128870 1725360          7 -11288701725360 -1128870 1725360       2079.564
5 -1128840 1725360          5 -11288401725360 -1128840 1725360       2081.792
6 -1128810 1725360          7 -11288101725360 -1128810 1725360       2083.144
               xy        x       y   aspect              xy        x       y
1 -11289601725360 -1128960 1725360 177.7081 -11289601725360 -1128960 1725360
2 -11289301725360 -1128930 1725360 212.5121 -11289301725360 -1128930 1725360
3 -11289001725360 -1128900 1725360 237.0969 -11289001725360 -1128900 1725360
4 -11288701725360 -1128870 1725360 233.5645 -11288701725360 -1128870 1725360
5 -11288401725360 -1128840 1725360 222.2563 -11288401725360 -1128840 1725360
6 -11288101725360 -1128810 1725360 206.8798 -11288101725360 -1128810 1725360
     slope              xy
1 2.285503 -11289601725360
2 2.902969 -11289301725360
3 4.543044 -11289001725360
4 5.080888 -11288701725360
5 4.701881 -11288401725360
6 4.078935 -11288101725360</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Remove xys that are repeated in each layer</span></span>
<span><span class="va">layers</span> <span class="op">=</span> <span class="va">layers</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">7</span>,<span class="fl">11</span>,<span class="fl">15</span>,<span class="fl">13</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nlcd"</span>, <span class="st">"elevation"</span>, <span class="st">"aspect"</span>, <span class="st">"slope"</span>,<span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># turn aspect into categorical</span></span>
<span><span class="va">aspect_categorical</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">aspect_categorical</span><span class="op">[</span><span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&lt;</span> <span class="fl">45</span> <span class="op">|</span> <span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&gt;=</span> <span class="fl">315</span><span class="op">]</span> <span class="op">=</span> <span class="st">"N"</span></span>
<span><span class="va">aspect_categorical</span><span class="op">[</span><span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&gt;=</span> <span class="fl">45</span> <span class="op">&amp;</span> <span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&lt;</span> <span class="fl">135</span><span class="op">]</span> <span class="op">=</span> <span class="st">"E"</span></span>
<span><span class="va">aspect_categorical</span><span class="op">[</span><span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&gt;=</span> <span class="fl">135</span> <span class="op">&amp;</span> <span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&lt;</span> <span class="fl">225</span><span class="op">]</span> <span class="op">=</span> <span class="st">"S"</span></span>
<span><span class="va">aspect_categorical</span><span class="op">[</span><span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&gt;=</span> <span class="fl">225</span> <span class="op">&amp;</span> <span class="va">layers</span><span class="op">$</span><span class="va">aspect</span> <span class="op">&lt;</span> <span class="fl">315</span><span class="op">]</span> <span class="op">=</span> <span class="st">"W"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">aspect_categorical</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>aspect_categorical
    E     N     S     W 
 6527  7899 30876 63948 </code></pre>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">aspect_categorical</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 FALSE 
109250 </code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">layers</span><span class="op">$</span><span class="va">aspect_categorical</span> <span class="op">=</span> <span class="va">aspect_categorical</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nlcd elevation   aspect    slope        x       y aspect_categorical
1    7  2074.788 177.7081 2.285503 -1128960 1725360                  S
2    7  2074.990 212.5121 2.902969 -1128930 1725360                  S
3    7  2076.914 237.0969 4.543044 -1128900 1725360                  W
4    7  2079.564 233.5645 5.080888 -1128870 1725360                  W
5    5  2081.792 222.2563 4.701881 -1128840 1725360                  S
6    7  2083.144 206.8798 4.078935 -1128810 1725360                  S</code></pre>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#write.table(layers,"layer1.txt",sep=",",col.names=TRUE, quote=FALSE)</span></span>
<span></span>
<span><span class="va">layers2</span> <span class="op">&lt;-</span> <span class="va">layers</span> <span class="co">#change to layers2 simply to avoid confusion with "layer" term in function </span></span>
<span><span class="co">#below</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section" class="level47"><p class="heading"></p>
<p>#NOTE: Script may contains Demonstration code that will subset number of locations to speed up processing of data during a course exercise. To prevent this, skip this line of code above.</p>
<p>12. We can now begin the task of sampling each of our locations using the code below. This code was created by Ryan Nielsen of West Inc.&nbsp;and was very helpful in this exercise. Alternatively, we could have extracted each covariate layer by layer and included it in our dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># grab values for points created above</span></span>
<span><span class="va">grab.values</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">layer</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># layer is data.frame of spatial layer, with values 'x', 'y', and ____?</span></span>
<span>    <span class="co"># x is a vector </span></span>
<span>    <span class="co"># y is a vector</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"x and y lengths differ"</span><span class="op">)</span></span>
<span>    <span class="va">z</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">layer</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">layer</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> </span>
<span>        <span class="co">#Could adjust this line or add another line to calculate moving window or </span></span>
<span>        <span class="co">#distance to nearest feature</span></span>
<span>        <span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">layer</span><span class="op">[</span><span class="va">dist</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span>,<span class="op">]</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#Grab all values from muleys for each layer in r</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="fu">grab.values</span><span class="op">(</span><span class="va">layers2</span>, <span class="va">muleys</span><span class="op">$</span><span class="va">X</span>, <span class="va">muleys</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nlcd elevation   aspect    slope        x       y aspect_categorical
437     6  2395.623 280.6483 2.295674 -1115880 1725360                  W
4371    6  2395.623 280.6483 2.295674 -1115880 1725360                  W
4372    6  2395.623 280.6483 2.295674 -1115880 1725360                  W
4373    6  2395.623 280.6483 2.295674 -1115880 1725360                  W
4374    6  2395.623 280.6483 2.295674 -1115880 1725360                  W
4375    6  2395.623 280.6483 2.295674 -1115880 1725360                  W</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">##NOTE that all values are the same but this is not correct.</span></span>
<span><span class="co">##What is the problem here and how do we fix it?</span></span>
<span></span>
<span><span class="co">#Need to grab Albers XY not UTM as in muleys above</span></span>
<span><span class="va">muleys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">deer.albers</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># grab all values for used and available points based on combined layer data set</span></span>
<span><span class="co"># can take 5+ minutes</span></span>
<span><span class="va">used</span> <span class="op">=</span> <span class="fu">grab.values</span><span class="op">(</span><span class="va">layers2</span>, <span class="va">muleys</span><span class="op">$</span><span class="va">X</span>, <span class="va">muleys</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co"># used$x = muleys$X</span></span>
<span><span class="co"># used$y = muleys$Y</span></span>
<span><span class="co"># used$animal_id = muleys$id</span></span>
<span><span class="va">used</span><span class="op">$</span><span class="va">use</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">used</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       nlcd elevation   aspect    slope        x       y aspect_categorical use
49782     6  2353.957 263.8254 4.252453 -1116960 1721970                  W   1
86836     6  2217.750 312.5775 6.662394 -1119690 1719420                  W   1
77667     7  2248.726 241.1956 6.642384 -1119450 1720050                  W   1
45847     7  2351.774 216.2095 2.682055 -1117020 1722240                  S   1
458471    7  2351.774 216.2095 2.682055 -1117020 1722240                  S   1
67683     7  2329.548 264.6193 2.048619 -1117440 1720740                  W   1</code></pre>
</div>
</div>
<p>13. We also need to get some measure of what is available for our mule deer population (2nd order selection) or for each mule deer (3rd order selection). We really do not understand the need for 2nd order selection unless you are looking at deer across different landscapes but hardly seems necessary for deer occupying similar areas such as our mule deer in southwestern Colorado. Below we will focus on 3rd order selection with used locations for each deer being compared to available locations randomly determined within each deer’s MCP.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Create MCP for all locations for each deer by ID (3nd order selection).</span></span>
<span><span class="co">#3 lines below needed for mcp function to work</span></span>
<span><span class="va">muleys2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">deer.albers</span><span class="op">)</span></span>
<span><span class="va">deer.spdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">muleys</span>,<span class="va">muleys2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/mcp.html">mcp</a></span><span class="op">(</span><span class="va">deer.spdf</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,percent<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Determine the habitat available using all code below</span></span>
<span><span class="co">#First create random sample of points in each polygon</span></span>
<span><span class="va">random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html">slot</a></span><span class="op">(</span><span class="va">cp</span>, <span class="st">'polygons'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/spsample.html">spsample</a></span><span class="op">(</span><span class="va">i</span>, n<span class="op">=</span><span class="fl">50</span>, type<span class="op">=</span><span class="st">'random'</span>, offset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span> ; <span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">random</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'red'</span>, pch<span class="op">=</span><span class="fl">3</span>, cex<span class="op">=</span><span class="fl">.5</span><span class="op">)</span><span class="co">#The number in double brackets changes polygons stack into a single SpatialPoints object</span></span>
<span><span class="va">random.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">'rbind'</span>, <span class="va">random</span><span class="op">)</span></span>
<span><span class="co">#Extract the original IDs</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html">slot</a></span><span class="op">(</span><span class="va">cp</span>, <span class="st">'polygons'</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/methods/slot.html">slot</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">'ID'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Determine the number of ACTUAL sample points generated for each polygon</span></span>
<span><span class="va">newpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">random</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">@</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">newpts</span> <span class="co">#Nice check of how many points generated per polygon </span></span>
<span><span class="co"># generate a reconstituted vector of point IDs</span></span>
<span><span class="va">pt_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ids</span>, <span class="va">newpts</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># promote to SpatialPointsDataFrame</span></span>
<span><span class="va">random.final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">random.merged</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>poly_id<span class="op">=</span><span class="va">pt_id</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># make 'random.final' a data.frame</span></span>
<span><span class="va">random.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">random.final</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">random.df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co"># can take 5+ minutes</span></span>
<span><span class="va">available</span> <span class="op">=</span> <span class="fu">grab.values</span><span class="op">(</span><span class="va">layers2</span>, <span class="va">random.df</span><span class="op">$</span><span class="va">x</span>, <span class="va">random.df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co"># available$x = random.df$x</span></span>
<span><span class="co"># available$y = random.df$y</span></span>
<span><span class="co"># available$animal_id = pt_id</span></span>
<span><span class="va">available</span><span class="op">$</span><span class="va">use</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">available</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>14. Bind together mule deer locations with covariates extracted (used) and random locations within each polygon by deer ID (available) into a master dataset for modeling (data). The (use) column identifies 1 as (used) and 0 as (available)</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">used</span><span class="op">)</span></span>
<span><span class="co">##A quick check of the data to determine if correct number of records.</span></span>
<span><span class="co">#''data.frame': 200 obs. of  9 variables:</span></span>
<span><span class="co">#100 locations used +</span></span>
<span><span class="co">#100 locations available (2 animals X 50 random locations)</span></span>
<span><span class="co">#= 100 #Confirmed in code below</span></span>
<span><span class="co"># nlcd              : num  7 6 7 7 7 7 7 7 7 6 ...</span></span>
<span><span class="co"># elevation         : int  2058 2058 2068 2068 2070 2072 2076 2062 2071 2071 ...</span></span>
<span><span class="co"># aspect            : num  105 278 105 80 135 ...</span></span>
<span><span class="co"># slope             : num  2.72 3.37 4.68 4.11 6.05 ...</span></span>
<span><span class="co"># x                 : num  -1127639 -1127610 -1127864 -1127805 -1127862 ...</span></span>
<span><span class="co"># y                 : num  1724257 1724271 1724091 1724218 1724174 ...</span></span>
<span><span class="co"># aspect_categorical: chr  "E" "W" "E" "E" ...</span></span>
<span><span class="co"># animal_id         : chr  "D12" "D12" "D12" "D12" ...</span></span>
<span><span class="co"># use               : num  0 0 0 0 0 0 0 0 0 0 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>15. The above code is for 3rd order selection within home range of each deer. We could also look at 3rd order selection within a buffered circle around each mule deer location that is common in Discrete Choice Models. The code is similar except the initial steps of creating buffered polygons and obviously includes a lot more polygons than simply MCPs for each deer. Determining the daily distance moved was done in Chapter 3 but new code is available to estimate for each deer or all deer combined.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">settbuff</span><span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">deer.albers</span>,<span class="fl">500</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Determine the habitat available using all code below</span></span>
<span><span class="co">#First create random sample of points in each polygon</span></span>
<span></span>
<span><span class="va">ranbuff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html">st_sample</a></span><span class="op">(</span><span class="va">settbuff</span>,size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>,exact <span class="op">=</span> <span class="cn">T</span>, type<span class="op">=</span><span class="st">"random"</span>, by_polygon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#ranbuff &lt;- st_sample(settbuff,size=c(3,3), type="random", by_polygon = TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">settbuff</span><span class="op">)</span><span class="op">)</span> ; <span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">ranbuff</span><span class="op">)</span>,add<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">'red'</span>, pch<span class="op">=</span><span class="fl">3</span>, cex<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Now to assign IDs, we needed help (https://github.com/r-spatial/sf/issues/1014) so thank you @edzer!</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">ranbuffwIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span>, geom <span class="op">=</span> <span class="va">ranbuff</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ranbuff.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">'rbind'</span>, <span class="va">ranbuffwIDs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span>id<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">ranbuff.merged</span><span class="op">)</span>,<span class="va">ranbuff.merged</span><span class="op">)</span>, geom <span class="op">=</span> <span class="va">randbuff</span><span class="op">)</span></span>
<span><span class="va">points_sf_joined</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">ranbuff</span>, <span class="va">settbuff</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># spatial join to get intersection of points and poly</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span><span class="op">)</span> <span class="co"># 'rgn_name'num' just one col from the polygon data that I chose to filter on, could use any. The idea is to get only the points that fall in the polygon</span></span>
<span></span>
<span><span class="va">buff_ids</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">settbuff</span>,<span class="va">ranbuff.merged</span><span class="op">)</span></span>
<span><span class="co">#Extract the original IDs</span></span>
<span><span class="va">buff_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">ranbuff.merged</span><span class="op">)</span> <span class="co">#sapply(slot(settbuff, 'polygons'), function(i) slot(i, 'ID'))</span></span>
<span><span class="va">buff_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">settbuff</span><span class="op">$</span><span class="va">id</span>, <span class="va">buff_ids</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span><span class="co">#Determine the number of ACTUAL sample points generated for each polygon</span></span>
<span><span class="va">buffpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ranbuff</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">@</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">buffpts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="co">#Nice check of how many points generated per polygon </span></span>
<span><span class="co"># generate a reconstituted vector of point IDs</span></span>
<span><span class="va">buffpt_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">buff_ids</span>, <span class="va">buffpts</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># promote to SpatialPointsDataFrame</span></span>
<span><span class="va">buff.final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span><span class="op">(</span><span class="va">ranbuff.merged</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>poly_id<span class="op">=</span><span class="va">buffpt_id</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span><span class="co">#Plot buff.final on buffered circles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">settbuff</span><span class="op">)</span> ; <span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">buff.final</span>, col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">3</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make 'buff.final' a data.frame</span></span>
<span><span class="va">buffer.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">buff.final</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">buffer.df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">buffer.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">random.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">buffer.df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># can take 5+ minutes</span></span>
<span><span class="va">buff_avail</span> <span class="op">=</span> <span class="fu">grab.values</span><span class="op">(</span><span class="va">layers2</span>, <span class="va">buffer.df</span><span class="op">$</span><span class="va">x</span>, <span class="va">buffer.df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">buff_avail</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="va">buffer.df</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">buff_avail</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">buffer.df</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">buff_avail</span><span class="op">$</span><span class="va">animal_id</span> <span class="op">=</span> <span class="va">buffpt_id</span></span>
<span><span class="va">buff_avail</span><span class="op">$</span><span class="va">use</span> <span class="op">=</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">data2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">buff_avail</span>, <span class="va">used</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Save workspace so all analysis are available</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save.image</a></span><span class="op">(</span><span class="st">"RSF_dataprep.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Before closing, let's save the "used" and available data set to use in the next exercise</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">used</span>, <span class="st">"MD_used.txt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">available</span>, <span class="st">"MD_avail.txt"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>16. We are going to focus the remainder of this chapter on Selection Ratios and Resource Selection Functions (RSFs) because Selection Ratios identify a general use of habitat given what is available that can be further explored and studied through use of RSFs. Resource Selection Functions are spatially-explicit models that predict the (relative) probability of use by an animal at a given area/location during a given time, based on the environmental conditions that influence or account for selection. There are numerous types of RSFs that can be performed based on the availability of data collected during the study and there are volumes of literature devoted to the topic of resource selection and sampling designs for radiotelemetry studies (Manly et al.&nbsp;2002, Cooper and Millspaugh 2001, Erickson et al.&nbsp;2001, Leban et al.&nbsp;2001).</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./LinearDistScript.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Preparing Linear Measures</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./MuledeerSR.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Selection Ratios</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Manual of Applied Spatial Ecology was written by W. David Walter.</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/walterASEL/Manual-of-Applied-Spatial-Ecology/edit/main/MD_DataPrep.Rmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/walterASEL/Manual-of-Applied-Spatial-Ecology/issues/new" class="toc-action">Report an issue</a></p></div></div></div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>