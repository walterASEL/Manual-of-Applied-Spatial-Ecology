<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="W. David Walter">
<title>Manual-Applied-Spatial-Ecology - 26&nbsp; Movement-based Kernel Density Estimation (MKDE)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./CatdBBMM.html" rel="next">
<link href="./BBMMscript.html" rel="prev">
<link href="./CoverSlide2.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Home-Range-Estimation.html">Home Range Estimation</a></li><li class="breadcrumb-item"><a href="./MKDEcat_script.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Movement-based Kernel Density Estimation (MKDE)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Manual-Applied-Spatial-Ecology</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Manual of Applied Spatial Ecology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Data-Manipulation-Management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Manipulation and Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MDprojections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transformations between coordinate systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TimeLagScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Import and Format Datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SoilScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulate Polygon Layer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RasterScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Manipulate Raster Data Layer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GridScripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Creating a Hexagonal Polygon Grid Over a Study Area</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./GridSystem2Script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Creating a Square Polygon Grid Over a Study Area</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BufferScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Creating Buffers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MidAtlantic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Mid-Atlantic layers using online sources</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Climate-Data-Interpretion.qmd</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ReadFilesScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Climate Data Interpretation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weather-Station-Code_Snowfall.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Using Data in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NetCDF_Script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importing Dynamically Downscaled Global Climate Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Movement-Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DMAdeerMovebank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Movement Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MovementScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Movement Trajectories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DistanceUniqueBurst.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Distance Between Locations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FPTscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">First Passage Time (FPT)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegTrajScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Regular Trajectories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NSDscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Net Squared Displacement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TrajDynScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Movement Trajectory Animation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Home-Range-Estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home Range Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HrefScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Home Range Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HlscvScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Kernel Density Estimation (KDE) with least squares cross validation (lscv)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Panther_All4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">KDE with plug-in bandwidth selection (hplug-in)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BBMMscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Brownian Bridge Movement Models (BBMM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MKDEcat_script.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Movement-based Kernel Density Estimation (MKDE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CatdBBMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dynamic Brownian Bridge Movement Models (dBBMM)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Landscape-Metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Landscape Metrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Frag_Auto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Landscape Metrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PatchAnalystScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Fragstats Metrics within Buffers</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./Resource-Selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resource Selection</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MCPscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Resource Selection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LinearDistScript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Preparing Linear Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MD_DataPrep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Preparing Additional Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MuledeerSR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Selection Ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LogisticRSF.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NegBinomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Negative Binomial</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Movement-based Kernel Density Estimation (MKDE)</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>If we want to take both BBMM and KDE to a higher level we can incorporate movement-based estimators of home range. Movement-based Kernel Density Estimation (MKDE) incorporates movements trajectories and habitat components of the landscape your animal occupies (Benhamou 2011, Benhamou and Cornelis 2010). This method requires a habitat layer and the adehabitatHR package requires that no duplicate entries exist for a given date so makes estimates of home range with GPS data problematic. Furthermore, after tirelessly trying this method for days using data with time intervals, we changed to data that had dates but then had to remove duplicates. If you have worked out all of these issues, you can skip ahead to MKDE estimates with your data starting at Step 6.</p>
<p>1. Open the script “MKDEcat_script.Rmd” and run code directly from the script</p>
<p>2. First we need to load the packages needed for the exercise</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">adehabitatHR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">adehabitatLT</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">chron</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/FedData/">FedData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3. Now let’s have a separate section of code to include projection information we will use throughout the exercise. In previous versions, these lines of code were within each block of code</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ll.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4269</span><span class="op">)</span></span>
<span><span class="va">utm.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">26917</span><span class="op">)</span></span>
<span><span class="va">albers.crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">5070</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4. We need to import our locations and get them in the form we need for this exercise before we can move forward</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">panther</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/pantherjitter.csv"</span>,header<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">panther</span><span class="op">$</span><span class="va">CatID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html">as.factor</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">CatID</span><span class="op">)</span></span>
<span><span class="co">#We first need to use the original dataset to calculate time between locations</span></span>
<span><span class="va">panther</span><span class="op">$</span><span class="va">NewTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">TIMEET2</span>,<span class="fl">4</span>, pad<span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></span>
<span><span class="va">panther</span><span class="op">$</span><span class="va">NewDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">DateET2</span>,<span class="va">panther</span><span class="op">$</span><span class="va">NewTime</span><span class="op">)</span></span>
<span><span class="co">#Used to sort data in code below for all deer</span></span>
<span><span class="va">panther</span><span class="op">$</span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">NewDate</span>, format<span class="op">=</span><span class="st">'%Y %m %d %H%M'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Sort Data</span></span>
<span><span class="va">panther</span> <span class="op">&lt;-</span> <span class="va">panther</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">CatID</span>, <span class="va">panther</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co">#TIME DIFF NECESSARY IN BBMM CODE</span></span>
<span><span class="va">timediff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/diff.html">diff</a></span><span class="op">(</span><span class="va">panther</span><span class="op">$</span><span class="va">DT</span><span class="op">)</span><span class="op">*</span><span class="fl">60</span></span>
<span><span class="co"># remove first entry without any difference </span></span>
<span><span class="va">panther</span> <span class="op">&lt;-</span> <span class="va">panther</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span> </span>
<span><span class="va">panther</span><span class="op">$</span><span class="va">timelag</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">timediff</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat143</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">panther</span>, <span class="va">panther</span><span class="op">$</span><span class="va">CatID</span> <span class="op">==</span> <span class="st">"143"</span><span class="op">)</span></span>
<span><span class="va">cat143</span> <span class="op">&lt;-</span> <span class="va">cat143</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span> <span class="co">#Remove first record with wrong timelag</span></span>
<span><span class="va">cat143</span><span class="op">$</span><span class="va">CatID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">droplevels</a></span><span class="op">(</span><span class="va">cat143</span><span class="op">$</span><span class="va">CatID</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Remove outlier locations</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">cat143</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">utm.crs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>,axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MKDEcat_script_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cat.albers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">albers.crs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NOTE: Two issues at this step held me back with the method for weeks so we will stress them here:</p>
<p>Extent of the raster layer selected - Although Extent was the lesser problem, it still needs to be address for several reasons. If the extent is too large or raster cell size too small then processing time increases. Although we would not really want to spend the time to clip raster habitat layers for each animal, you may need to have separate rasters for different areas of your study site to cut down on processing time. More importantly, animals need to be within the same grid for analysis using MKDE/BRB home range estimates. This will become more apparent later but preparing habitat or landscape layers for all animals using the same habitat extent will save time in the end.</p>
<p>Projection of the raster layer and locations - Even we missed this one with all our experiences and constant issues with data layers in different projections. We assumed that defining the projection with R would take care of this issue but we could not have been more wrong. So before we move forward, we want to demonstrate our thought processes here and how we solved this problem.</p>
<p>5. If we get some NA errors because our grid does not encompass our panther locations then we can expand the grid size extending beyond our locations using methods in an earlier exercise.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create vectors of the x and y points using boundary box created around deer locations</span></span>
<span><span class="va">bb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">cat.albers</span><span class="op">)</span></span>
<span>     </span>
<span><span class="va">increment</span> <span class="op">=</span> <span class="fl">2000</span></span>
<span><span class="va">minx</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">xmin</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maxx</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">xmax</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">miny</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">ymin</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maxy</span><span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bb1</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span><span class="op">+</span><span class="op">(</span><span class="va">increment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">minx</span>, xmax <span class="op">=</span> <span class="va">maxx</span>, </span>
<span>                    ymin <span class="op">=</span> <span class="va">miny</span>, ymax <span class="op">=</span> <span class="va">maxy</span><span class="op">)</span>,</span>
<span>                  crs <span class="op">=</span> <span class="fl">5070</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="va">my_bbox</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>6. So the raster layer that is included in this exercise is in UTM Zone 17. Now, import the raster layer to have layers in the same projection.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">FLnlcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/FedData/reference/get_nlcd.html">get_nlcd</a></span><span class="op">(</span>template<span class="op">=</span><span class="va">boundary</span>, year <span class="op">=</span> <span class="fl">2006</span>, label <span class="op">=</span> <span class="st">'Florida'</span>,dataset <span class="op">=</span> <span class="st">"landcover"</span>, force.redo <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nlcd.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">FLnlcd</span>, xy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">nlcd.df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">FLnlcd</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nlcd.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">nlcd.df2</span><span class="op">$</span><span class="va">x</span>,y<span class="op">=</span><span class="va">nlcd.df2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">##Cast over to SPxDF</span></span>
<span><span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialGridDataFrame.html">SpatialPixelsDataFrame</a></span><span class="op">(</span><span class="va">nlcd.xy</span>,<span class="va">nlcd.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html">crs</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">FLnlcd</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span><span class="co">#"NAD83 / Conus Albers"</span></span>
<span><span class="co">#plot(habitat)</span></span>
<span></span>
<span><span class="co">#Create an ltraj trajectory object. </span></span>
<span><span class="va">ltraj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/as.ltraj.html">as.ltraj</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">cat.albers</span><span class="op">)</span>, <span class="va">cat.albers</span><span class="op">$</span><span class="va">DT</span>, id <span class="op">=</span> <span class="va">cat.albers</span><span class="op">$</span><span class="va">Sex</span>, burst <span class="op">=</span> <span class="va">cat.albers</span><span class="op">$</span><span class="va">Sex</span>, </span>
<span>  typeII <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#plot(ltraj, spixdf=habitat)</span></span>
<span><span class="co">#writeRaster(FLnlcd,"FL_nlcd.tif",format="GTiff",datatype = 'INT1U',overwrite=T)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>7. With the same projections for our 2 data layers, we can move forward. First we need to create ltraj as in Chapter 3 and use some additional code to overlay the trajectory onto the Spatial Pixels Data Frame using the command “spixdf” as in the code below that results in Fig. 4.11. Basically, if this works then we are on the right path to moving forward with MKDE.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># FLnlcd2 &lt;- rast("data/FL_nlcd.tif")</span></span>
<span><span class="co"># FLnlcd2 &lt;- project(FLnlcd2,FLnlcd,method="near")</span></span>
<span><span class="co"># nlcd.df2 &lt;- as.data.frame(FLnlcd2, xy=FALSE)</span></span>
<span><span class="co"># nlcd.df3 &lt;- as.data.frame(FLnlcd2, xy=TRUE)</span></span>
<span><span class="co"># nlcd.xy &lt;- data.frame(x=nlcd.df3$x,y=nlcd.df3$y)</span></span>
<span><span class="co"># ##Cast over to SPxDF</span></span>
<span><span class="co"># habitat2 &lt;- SpatialPixelsDataFrame(nlcd.xy,nlcd.df)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #Create an ltraj trajectory object. </span></span>
<span><span class="co"># ltraj &lt;- as.ltraj(st_coordinates(cat.albers), cat.albers$DT, id = cat.albers$Sex, burst = cat.albers$Sex, </span></span>
<span><span class="co">#   typeII = TRUE)</span></span>
<span><span class="co"># plot(ltraj, spixdf=habitat)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>8. Now identify habitats that can and can not be used by panthers</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Be sure to do this step after plotting ltraj onto spixdf or won't work!</span></span>
<span><span class="co">#This step just builds a "fake" habitat map with habitat=1</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/gridded-methods.html">fullgrid</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">hab</span> <span class="op">&lt;-</span> <span class="va">habitat</span></span>
<span><span class="va">hab</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hab</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#This step is needed to convert SpatialGrid to SpatialPixels for use in "ud" estimation </span></span>
<span><span class="co">#if needed</span></span>
<span><span class="co">#"habitat" in "grid=habitat" must be of class SpatialPixels</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/gridded-methods.html">fullgrid</a></span><span class="op">(</span><span class="va">hab</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">hab</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>9. Now we can begin to create Movement-based KDEs using biased random bridges (BRBs)</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Assign parameter values for BRB </span></span>
<span><span class="co"># Parameters for the Biased Random Bridge Kernel approach </span></span>
<span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fl">24</span><span class="op">*</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#set the maximum time between locations to be just more than 1 day</span></span>
<span><span class="va">lmin</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co">#locations less than 50 meters apart are considered inactive.   </span></span>
<span><span class="va">hmin</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co">#arbitrarily set to be same as hab grid cell resolution </span></span>
<span></span>
<span><span class="co">#Diffusion component for each habitat type using plug-in method</span></span>
<span><span class="va">vv</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB.D</a></span><span class="op">(</span><span class="va">ltraj</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>,  habitat <span class="op">=</span> <span class="va">hab</span><span class="op">)</span></span>
<span><span class="va">vv</span></span>
<span></span>
<span><span class="va">ud</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB</a></span><span class="op">(</span><span class="va">ltraj</span>, D <span class="op">=</span> <span class="va">vv</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>, hmin<span class="op">=</span><span class="va">hmin</span>, grid <span class="op">=</span> <span class="va">hab</span>, b<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>  extent<span class="op">=</span><span class="fl">0.1</span>, tau <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">ud</span></span>
<span></span>
<span><span class="co">#Address names in ud by assigning them to be the same as the ids in ltraj</span></span>
<span><span class="co">#Must be done before using "getverticeshr" function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ud</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>10. Create contours using getverticeshr to display or export as shapefiles (Fig. 4.15).</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ver1_99</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud</span>, percent<span class="op">=</span><span class="fl">99</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver1_99</span><span class="op">)</span></span>
<span><span class="co">#ver1_95 &lt;- getverticeshr(ud, percent=95, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="co">#ver1_90 &lt;- getverticeshr(ud, percent=90, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="co">#ver1_80 &lt;- getverticeshr(ud, percent=80, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="va">ver1_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud</span>, percent<span class="op">=</span><span class="fl">50</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver1_99</span><span class="op">)</span></span>
<span><span class="co">#plot(ver1_95, add=T)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver1_50</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>11. Now let’s create a new UD using an actual habitat layer that has more than “used/unused” such as the 7 habitat categories from original dataset</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Start by importing the habitat layer again and run the following</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">19</span>, <span class="fl">1</span>, <span class="fl">20</span>, <span class="fl">39</span>, <span class="fl">2</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">3</span>, <span class="fl">51</span>, <span class="fl">68</span>, <span class="fl">4</span>, <span class="fl">69</span>,<span class="fl">79</span>, <span class="fl">5</span>, <span class="fl">80</span>, <span class="fl">88</span>, <span class="fl">6</span>, <span class="fl">89</span>, <span class="fl">99</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">rclmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">m</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/classify.html">classify</a></span><span class="op">(</span><span class="va">FLnlcd</span>, <span class="va">rclmat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rc.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">rc</span>, xy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">rc.df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">rc</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rc.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">rc.df2</span><span class="op">$</span><span class="va">x</span>,y<span class="op">=</span><span class="va">rc.df2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">##Cast over to SPxDF</span></span>
<span><span class="va">habitat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialGridDataFrame.html">SpatialPixelsDataFrame</a></span><span class="op">(</span><span class="va">rc.xy</span>,<span class="va">rc.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html">crs</a></span><span class="op">(</span><span class="va">habitat2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">FLnlcd</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">habitat2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ltraj</span>, spixdf<span class="op">=</span><span class="va">habitat2</span><span class="op">)</span></span>
<span><span class="co">#CODE TO CONDUCT BRB</span></span>
<span><span class="co">#Assign parameter values for BRB </span></span>
<span><span class="co"># Parameters for the Biased Random Bridge Kernel approach </span></span>
<span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fl">24</span><span class="op">*</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#set the maximum time between locations to be just more than 1 day</span></span>
<span><span class="va">lmin</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="co">#locations less than 50 meters apart are considered inactive.   </span></span>
<span><span class="va">hmin</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co">#arbitrarily set to be same as hab grid cell resolution </span></span>
<span></span>
<span><span class="co">#Diffusion component for each habitat type using plug-in method</span></span>
<span><span class="va">vv2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB.D</a></span><span class="op">(</span><span class="va">ltraj</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>,  habitat <span class="op">=</span> <span class="va">habitat2</span><span class="op">)</span></span>
<span><span class="va">vv2</span></span>
<span></span>
<span><span class="va">ud2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB</a></span><span class="op">(</span><span class="va">ltraj</span>, D <span class="op">=</span> <span class="va">vv2</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>, hmin<span class="op">=</span><span class="va">hmin</span>, habitat <span class="op">=</span> <span class="va">habitat2</span>, b<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>  extent<span class="op">=</span><span class="fl">0.1</span>, tau <span class="op">=</span> <span class="fl">300</span>, same4all<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ud2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ver2_99</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud2</span>, percent<span class="op">=</span><span class="fl">99</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#ver2_95 &lt;- getverticeshr(ud2, percent=95, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="co">#ver2_90 &lt;- getverticeshr(ud2, percent=90, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="co">#ver2_80 &lt;- getverticeshr(ud2, percent=80, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="va">ver2_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud2</span>, percent<span class="op">=</span><span class="fl">50</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>12. Now let’s create a new UD using an actual habitat layer that has more than “used/unused” such as the 4 habitat categories from original dataset</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#4 habitats instead of the 7 above with water, open, and forested</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">39</span>, <span class="fl">1</span>, <span class="fl">40</span>, <span class="fl">68</span>, <span class="fl">2</span>, <span class="fl">69</span>,<span class="fl">88</span>, <span class="fl">3</span>, <span class="fl">89</span>, <span class="fl">99</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">rclmat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">m1</span>, ncol<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/classify.html">classify</a></span><span class="op">(</span><span class="va">FLnlcd</span>, <span class="va">rclmat1</span><span class="op">)</span></span>
<span><span class="va">rc1.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">rc1</span>, xy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">rc1.df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">rc1</span>, xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rc1.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">rc1.df2</span><span class="op">$</span><span class="va">x</span>,y<span class="op">=</span><span class="va">rc1.df2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">##Cast over to SPxDF</span></span>
<span><span class="va">habitat3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialGridDataFrame.html">SpatialPixelsDataFrame</a></span><span class="op">(</span><span class="va">rc1.xy</span>,<span class="va">rc1.df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html">crs</a></span><span class="op">(</span><span class="va">habitat3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">FLnlcd</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">habitat3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ltraj</span>, spixdf<span class="op">=</span><span class="va">habitat3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Diffusion component for each habitat type using plug-in method</span></span>
<span><span class="va">vv3</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB.D</a></span><span class="op">(</span><span class="va">ltraj</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>,  habitat <span class="op">=</span> <span class="va">habitat3</span><span class="op">)</span></span>
<span><span class="va">vv3</span></span>
<span></span>
<span><span class="va">ud3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/BRB.html">BRB</a></span><span class="op">(</span><span class="va">ltraj</span>, D <span class="op">=</span> <span class="va">vv3</span>, Tmax <span class="op">=</span> <span class="va">tmax</span>, Lmin <span class="op">=</span> <span class="va">lmin</span>, hmin<span class="op">=</span><span class="va">hmin</span>, habitat <span class="op">=</span> <span class="va">habitat3</span>, b<span class="op">=</span><span class="cn">TRUE</span>, extent<span class="op">=</span><span class="fl">0.1</span>, tau <span class="op">=</span> <span class="fl">300</span>, same4all<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ud3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ver3_99</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud3</span>, percent<span class="op">=</span><span class="fl">99</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#ver3_95 &lt;- getverticeshr(ud3, percent=95, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="co">#ver3_80 &lt;- getverticeshr(ud3, percent=80, standardize = TRUE, whi = id(ltraj))</span></span>
<span><span class="va">ver3_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatHR/man/getverticeshr.html">getverticeshr</a></span><span class="op">(</span><span class="va">ud3</span>, percent<span class="op">=</span><span class="fl">50</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>, whi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adehabitatLT/man/burst.html">id</a></span><span class="op">(</span><span class="va">ltraj</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>15. Now we will plot these for comparison with the habitat layer differing by each analysis.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver1_99</span>,main<span class="op">=</span><span class="st">"mKDE no habitat"</span>,xlab<span class="op">=</span><span class="st">"X"</span>, ylab<span class="op">=</span><span class="st">"Y"</span>, font<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.8</span>, axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#plot(ver1_95, lty=6, add=TRUE)</span></span>
<span><span class="co">#plot(ver1_90, add=TRUE)</span></span>
<span><span class="co">#plot(ver1_80, add=TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver1_50</span>, col<span class="op">=</span><span class="st">"red"</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">cat.albers</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver2_99</span>,main<span class="op">=</span><span class="st">"mKDE 7 habitats"</span>,xlab<span class="op">=</span><span class="st">"X"</span>, ylab<span class="op">=</span><span class="st">"Y"</span>, font<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.8</span>, axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#plot(ver2_95, lty=6, add=TRUE)</span></span>
<span><span class="co">#plot(ver2_90, add=TRUE)</span></span>
<span><span class="co">#plot(ver2_80, add=TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver2_50</span>,col<span class="op">=</span><span class="st">"red"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">cat.albers</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver3_99</span>,main<span class="op">=</span><span class="st">"mKDE 4 habitats"</span>,xlab<span class="op">=</span><span class="st">"X"</span>, ylab<span class="op">=</span><span class="st">"Y"</span>, font<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.8</span>, axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#plot(ver3_95, lty=6, add=TRUE)</span></span>
<span><span class="co">#plot(ver3_80, add=TRUE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ver3_50</span>,col<span class="op">=</span><span class="st">"red"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">cat.albers</span>, pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./BBMMscript.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Brownian Bridge Movement Models (BBMM)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./CatdBBMM.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dynamic Brownian Bridge Movement Models (dBBMM)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">R for Data Science (2e) was written by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>